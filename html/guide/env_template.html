<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enviroment templates &mdash; SAPPC 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> SAPPC
            <img src="../_static/SAPPC_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SAPPC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Enviroment templates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/env_template.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="enviroment-templates">
<span id="env-template"></span><h1>Enviroment templates<a class="headerlink" href="#enviroment-templates" title="Permalink to this heading"></a></h1>
<p>As mentioned in the previous step, <strong>FRobs_RL</strong> includes two templates to facilitate the creation of a new Gym enviroment. These templates can be found in the folder of  <a class="reference external" href="https://github.com/jmfajardod/frobs_rl/tree/main/src/frobs_rl/templates">templates</a> and are the two basic templates for the <strong>CustomRobotEnv</strong> and  <strong>CustomTaskEnv</strong> classes.</p>
<section id="customrobotenv">
<h2>CustomRobotEnv<a class="headerlink" href="#customrobotenv" title="Permalink to this heading"></a></h2>
<p>The <strong>CustomRobotEnv</strong> must the first class to be filled, as the <strong>CustomTaskEnv</strong> will inherit this class. In the template <em>init</em> function there are already many parameters included like the parameters to launch Gazebo along the class, the parameters related to the the URDF model loading of the robot, the controllers spawning, namespaces of the parameters, etc. An exert of the function is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">If spawning the robot using the given spawner then set the corresponding environment variables.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">spawn_robot</span><span class="o">=</span><span class="kc">False</span>
<span class="n">model_name_in_gazebo</span><span class="o">=</span><span class="s2">&quot;robot&quot;</span>
<span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;/robot&quot;</span>
<span class="n">pkg_name</span><span class="o">=</span><span class="kc">None</span>
<span class="n">urdf_file</span><span class="o">=</span><span class="kc">None</span>
<span class="n">urdf_folder</span><span class="o">=</span><span class="s2">&quot;/urdf&quot;</span>
<span class="n">controller_file</span><span class="o">=</span><span class="kc">None</span>
<span class="n">controller_list</span><span class="o">=</span><span class="kc">None</span>
<span class="n">urdf_xacro_args</span><span class="o">=</span><span class="kc">None</span>
<span class="n">rob_state_publisher_max_freq</span><span class="o">=</span> <span class="kc">None</span>
<span class="n">model_pos_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_pos_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_pos_z</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">model_ori_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_w</span><span class="o">=</span><span class="mf">0.0</span>
</pre></div>
</div>
<p>The user only needs to change this parameters and the inhered class <strong>RobotBasicEnv</strong> will spawn the robot with the position and orientation specified. An example of this is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spawn_robot</span><span class="o">=</span><span class="kc">True</span>
<span class="n">model_name_in_gazebo</span><span class="o">=</span><span class="s2">&quot;kobuki_robot&quot;</span>
<span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>
<span class="n">pkg_name</span><span class="o">=</span><span class="s2">&quot;kobuki_maze_rl&quot;</span>
<span class="n">urdf_file</span><span class="o">=</span><span class="s2">&quot;kobuki_lidar.urdf.xacro&quot;</span>
<span class="n">urdf_folder</span><span class="o">=</span><span class="s2">&quot;/urdf&quot;</span>
<span class="n">controller_file</span><span class="o">=</span><span class="kc">None</span>
<span class="n">controller_list</span><span class="o">=</span><span class="p">[]</span>
<span class="n">urdf_xacro_args</span><span class="o">=</span><span class="kc">None</span>
<span class="n">rob_state_publisher_max_freq</span><span class="o">=</span><span class="mi">30</span>
<span class="n">model_pos_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_pos_y</span><span class="o">=</span><span class="mf">10.0</span><span class="p">;</span> <span class="n">model_pos_z</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">model_ori_x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span> <span class="n">model_ori_w</span><span class="o">=</span><span class="mf">1.0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if the user decides to spawn the robot without the use of the <strong>RobotBasicEnv</strong> class they can use the functions availiable in <strong>FRobs_RL</strong> like <em>spawn_model_in_gazebo</em>, <em>gazebo_set_time_step</em>, <em>urdf_load_from_pkg</em>, etc.</p>
</div>
<p>After filling the <em>init</em> function of the <strong>CustomRobotEnv</strong> the user can fill the optional function <em>_check_subs_and_pubs_connection</em> if all publishers or subscribers of the enviroment are declared inside this class.</p>
<p>Finally, the user only needs to change the name of the class so the <strong>CustomTaskEnv</strong> can inherit it. An example is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With default name</span>
<span class="k">class</span> <span class="nc">CustomRobotEnv</span><span class="p">(</span><span class="n">robot_BasicEnv</span><span class="o">.</span><span class="n">RobotBasicEnv</span><span class="p">):</span>

<span class="c1"># With new name to allow class inheritance</span>
<span class="k">class</span> <span class="nc">KobukiLIDAREnv</span><span class="p">(</span><span class="n">robot_BasicEnv</span><span class="o">.</span><span class="n">RobotBasicEnv</span><span class="p">):</span>
</pre></div>
</div>
</section>
<section id="customtaskenv">
<h2>CustomTaskEnv<a class="headerlink" href="#customtaskenv" title="Permalink to this heading"></a></h2>
<p>After creating a <strong>CustomRobotEnv</strong> the user must fill the task related template <strong>CustomTaskEnv</strong>. The first change needed is the class that the Task enviroment will inherit and the name of the Task enviroment; the class to inherit must be appropiately imported and its name should be change in the class, an example is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># With default inherit</span>
<span class="kn">from</span> <span class="nn">frobs_rl.templates</span> <span class="kn">import</span> <span class="n">CustomRobotEnv</span> <span class="c1"># Replace with your own robot env</span>
<span class="k">class</span> <span class="nc">CustomTaskEnv</span><span class="p">(</span><span class="n">CustomRobotEnv</span><span class="o">.</span><span class="n">CustomRobotEnv</span><span class="p">):</span>

<span class="c1"># With appropiate inherit of created RobotEnv</span>
<span class="kn">from</span> <span class="nn">kobuki_maze_rl.robot_env</span> <span class="kn">import</span> <span class="n">kobuki_lidar_env</span>
<span class="k">class</span> <span class="nc">KobukiMazeEnv</span><span class="p">(</span><span class="n">kobuki_lidar_env</span><span class="o">.</span><span class="n">KobukiLIDAREnv</span><span class="p">):</span>
</pre></div>
</div>
<p>After this change the user must fill the <em>init</em> function of the class where the action and observations spaces must be filled according to the task, some supported spaces are the Discrete space or the Box space, which is a continous space with limit. An example of how to fill the spaces is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using Discrete spaces</span>
<span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="n">n_actions</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="n">n_observations</span><span class="p">)</span>

<span class="c1"># Using Box spaces</span>
<span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>Also, the user can create different subscribers or publishers in the <em>init</em> function of this class whether is to obtain observations or to publish some markers, etc.</p>
<p>After filling the <em>init</em> function must fill the following functions:</p>
<ul class="simple">
<li><p>_send_action: The function used to send the commands to the robot.</p></li>
<li><p>_get_observation: The function to execute when observations from the enviroment are needed.</p></li>
<li><p>_get_reward: The function that calculates and returns the reward based on the action of the agent.</p></li>
<li><p>_check_if_done: The function to check if the robot sucess finished the task or reached the goal.</p></li>
<li><p>_set_episode_init_params (Optional): The function to set ROS or Gazebo initial parameters for the episode, e.g.: the initial position of the robot, the location of obstacles, etc.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some examples of how to fill these functions can be seen in the resources repository <a class="reference external" href="https://github.com/jmfajardod/frobs_rl_resources">FRobs_RL Resources</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The user can also create other functions in the class according to their needs.</p>
</div>
<p>Finally, the user must change the Gym <em>register</em> function, located at the top of the file, so the enviroment gets properly registered and can be called from another Python script. The user must select an unique ID (String), they must change the entry point (the location of the file and name of the class) and optionally select a maximum number of steps per episode. An example of how to change the <em>register</em> function is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Default register</span>
<span class="n">register</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;CustomTaskEnv-v0&#39;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s1">&#39;frobs_rl.templates.CustomTaskEnv:CustomTaskEnv&#39;</span><span class="p">,</span>
    <span class="n">max_episode_steps</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Changed register</span>
<span class="n">register</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;KobukiMazeEnv-v0&#39;</span><span class="p">,</span>
    <span class="n">entry_point</span><span class="o">=</span><span class="s1">&#39;kobuki_maze_rl.task_env.kobuki_maze:KobukiMazeEnv&#39;</span><span class="p">,</span>
    <span class="n">max_episode_steps</span><span class="o">=</span><span class="mi">100000000000</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>Templates<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, UNAL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>