<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carro Circulación &mdash; SAPPC 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Lane Detection" href="lanes.html" />
    <link rel="prev" title="API" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> SAPPC
            <img src="../../_static/SAPPC_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to SAPPC documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/data_acquisition.html">How to use the track’s data acquisition pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/process_data.html">How to process the data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/update_line_stops.html">Update lines for Line stop maneuvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/update_parking_areas.html">Update areas for parking spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/update_cone_position.html">Update cone position for slaloms</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Carro Circulación</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-run-the-car-s-public-highway-test">How to run the Car’s public highway test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description-of-the-car-s-public-highway-test-algorithms">Description of the Car’s public highway test algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameters-to-change">Parameters to change</a></li>
<li class="toctree-l3"><a class="reference internal" href="#algorithms-used">Algorithms used</a><ul>
<li class="toctree-l4"><a class="reference internal" href="lanes.html">Lane Detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="traffic_lights.html">Traffic Lights Recognition</a></li>
<li class="toctree-l4"><a class="reference internal" href="objects.html">Object Recognition</a></li>
<li class="toctree-l4"><a class="reference internal" href="dashboard.html">Dashboard GUI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../moto_circulacion/index.html">Moto Circulación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../carro_pista/index.html">Carro pista</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moto_pista/index.html">Moto pista</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SAPPC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">API</a> &raquo;</li>
      <li>Carro Circulación</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api/carro_circulacion/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="carro-circulacion">
<h1>Carro Circulación<a class="headerlink" href="#carro-circulacion" title="Permalink to this heading"></a></h1>
<section id="how-to-run-the-car-s-public-highway-test">
<h2>How to run the Car’s public highway test<a class="headerlink" href="#how-to-run-the-car-s-public-highway-test" title="Permalink to this heading"></a></h2>
<p>To run the Car’s public highway test (Carro Circulación), the following steps must be followed:</p>
<ol class="arabic">
<li><p>Open the <em>/ansv_componente3/Vehiculos/Automovil_circulacion/Vision/process_video.py</em> file and edit <strong>line 23</strong>, changing the <em>test_path</em> variable to the folder of the test to be processed.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">22</span>    <span class="c1"># Open video</span>
<span class="hll"><span class="linenos">23</span>    <span class="n">test_path</span> <span class="o">=</span> <span class="s2">&quot;/media/control-center/91337259-8dce-493b-82b6-ec347b39f11a/home/centro-control/ansv_componente_3/Pista/Vision/Data_acquisition/build/Prueba_16_09_2022_12_28_51/Prueba_16_09_2022_12_28_51&quot;</span>
</span><span class="linenos">24</span>    <span class="n">datetime_test</span> <span class="o">=</span> <span class="p">((</span><span class="n">test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Prueba_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="n">date_test</span> <span class="o">=</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Then run the command in a terminal:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 process_video.py
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="description-of-the-car-s-public-highway-test-algorithms">
<h2>Description of the Car’s public highway test algorithms<a class="headerlink" href="#description-of-the-car-s-public-highway-test-algorithms" title="Permalink to this heading"></a></h2>
<p>The algorithms used in the Car’s public highway test are: <strong>Lane detection, Traffic light Recognition, Object Recognition, and Dashboard visualization</strong>. The main file of the process is located in <em>/ansv_componente3/Vehiculos/Automovil_circulacion/Vision/process_video.py</em>.</p>
<p>In the <em>process_video.py</em> file, the test folder is selected and opened to know the date and time of the test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">19</span>    <span class="c1"># Open video</span>
<span class="linenos">20</span>    <span class="n">test_path</span> <span class="o">=</span> <span class="s2">&quot;/media/control-center/91337259-8dce-493b-82b6-ec347b39f11a/home/centro-control/ansv_componente_3/Pista/Vision/Data_acquisition/build/Prueba_16_09_2022_12_28_51/Prueba_16_09_2022_12_28_51&quot;</span>
<span class="linenos">21</span>    <span class="n">datetime_test</span> <span class="o">=</span> <span class="p">((</span><span class="n">test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Prueba_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">date_test</span> <span class="o">=</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">datetime_test</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="n">video_folder</span> <span class="o">=</span> <span class="n">test_path</span> <span class="o">+</span> <span class="s2">&quot;/videos&quot;</span>
<span class="linenos">25</span>    <span class="n">video_folder_front</span> <span class="o">=</span> <span class="n">video_folder</span> <span class="o">+</span> <span class="s2">&quot;/front_camera&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">video_csv_path</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">video_folder_front</span> <span class="o">+</span> <span class="s2">&quot;/camera*.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">28</span>    <span class="n">video_csv_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">video_csv_path</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">video_num_frames</span> <span class="o">=</span> <span class="n">video_csv_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>After opening the folder, the classes for all the algorithms are initialized.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">38</span>    <span class="c1"># Open Lane_detection model</span>
<span class="linenos">39</span>    <span class="n">lane_detector</span> <span class="o">=</span> <span class="n">LaneDetector</span><span class="p">(</span><span class="n">video_folder_front</span> <span class="o">+</span> <span class="s2">&quot;/video_&quot;</span> <span class="o">+</span> <span class="n">test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_lanes.csv&quot;</span><span class="p">,</span> <span class="n">det_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="c1"># Open Traffic_light_recognition model</span>
<span class="linenos">42</span>    <span class="n">traffic_light_detector</span> <span class="o">=</span> <span class="n">TrafficLightDetector</span><span class="p">(</span><span class="n">video_folder_front</span> <span class="o">+</span> <span class="s2">&quot;/video_&quot;</span> <span class="o">+</span> <span class="n">test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_traffic_lights.csv&quot;</span><span class="p">,</span> <span class="n">det_threshold</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    <span class="c1"># Open Object_recognition model</span>
<span class="linenos">45</span>    <span class="n">object_detector</span> <span class="o">=</span> <span class="n">ObjectDetector</span><span class="p">(</span><span class="n">video_folder_front</span> <span class="o">+</span> <span class="s2">&quot;/video_&quot;</span> <span class="o">+</span> <span class="n">test_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_objects.csv&quot;</span><span class="p">,</span> <span class="n">det_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span>    <span class="c1"># Open GUI functions</span>
<span class="linenos">48</span>    <span class="n">GPS_csv</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">test_path</span> <span class="o">+</span> <span class="s2">&quot;/gps_data/gps*.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">49</span>    <span class="n">Dashboard_csv</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">test_path</span> <span class="o">+</span> <span class="s2">&quot;/can_data/obc_dash*.csv&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#TODO change naming of files</span>
<span class="linenos">50</span>
<span class="linenos">51</span>    <span class="n">dashboard_vis</span> <span class="o">=</span> <span class="n">Dashboard</span><span class="p">(</span><span class="n">GPS_csv</span><span class="p">,</span> <span class="n">Dashboard_csv</span><span class="p">,</span> <span class="n">date_test</span><span class="p">)</span>
</pre></div>
</div>
<p>From the CSV of the video the proper video file is selected and opened.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 60</span>            <span class="c1"># Read row from csv</span>
<span class="linenos"> 61</span>            <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 62</span>                <span class="n">frame_data</span> <span class="o">=</span> <span class="n">video_csv_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
<span class="linenos"> 63</span>                <span class="n">date_time_vid</span> <span class="o">=</span> <span class="n">date_test</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">frame_data</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
<span class="linenos"> 64</span>                <span class="n">date_time_vid</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_time_vid</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">_%m_%Y %H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>            <span class="k">except</span><span class="p">:</span>
<span class="linenos"> 67</span>                <span class="n">timedelta_video</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">video_fps</span><span class="p">)</span>
<span class="linenos"> 68</span>                <span class="n">date_time_vid</span> <span class="o">=</span> <span class="n">date_time_vid</span> <span class="o">+</span> <span class="n">timedelta_video</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>            <span class="k">if</span> <span class="n">video_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 71</span>                <span class="n">video_name</span> <span class="o">=</span> <span class="n">frame_data</span><span class="p">[</span><span class="s2">&quot;VideoFile&quot;</span><span class="p">]</span>
<span class="linenos"> 72</span>                <span class="n">video_path</span> <span class="o">=</span> <span class="n">test_path</span> <span class="o">+</span> <span class="s2">&quot;/videos&quot;</span> <span class="o">+</span> <span class="n">video_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 73</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Video path: &quot;</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>                <span class="c1"># Open video</span>
<span class="linenos"> 76</span>                <span class="n">video_capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
<span class="linenos"> 77</span>                <span class="k">if</span> <span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
<span class="linenos"> 78</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error opening video stream or file&quot;</span><span class="p">)</span>
<span class="linenos"> 79</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 80</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened file&quot;</span><span class="p">)</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>                <span class="c1"># Get video properties</span>
<span class="linenos"> 83</span>                <span class="n">frame_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="linenos"> 84</span>                <span class="n">frame_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos"> 85</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original video size: &quot;</span><span class="p">,</span> <span class="n">frame_width</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">)</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>                <span class="n">video_fps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="linenos"> 88</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FPS: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">video_fps</span><span class="p">))</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>                <span class="n">video_num_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="linenos"> 91</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of frames: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">video_num_frames</span><span class="p">))</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>            <span class="k">elif</span> <span class="n">video_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">frame_data</span><span class="p">[</span><span class="s2">&quot;VideoFile&quot;</span><span class="p">]:</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Changing to new video&quot;</span><span class="p">)</span>
<span class="linenos"> 97</span>                <span class="n">video_name</span> <span class="o">=</span> <span class="n">frame_data</span><span class="p">[</span><span class="s2">&quot;VideoFile&quot;</span><span class="p">]</span>
<span class="linenos"> 98</span>                <span class="n">video_path</span> <span class="o">=</span> <span class="n">test_path</span> <span class="o">+</span> <span class="s2">&quot;/videos&quot;</span> <span class="o">+</span> <span class="n">video_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 99</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Video path: &quot;</span><span class="p">,</span> <span class="n">video_path</span><span class="p">)</span>
<span class="linenos">100</span>
<span class="linenos">101</span>                <span class="c1"># Open video</span>
<span class="linenos">102</span>                <span class="n">video_capture</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
<span class="linenos">103</span>                <span class="k">if</span> <span class="p">(</span><span class="n">video_capture</span><span class="o">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
<span class="linenos">104</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error opening video stream or file&quot;</span><span class="p">)</span>
<span class="linenos">105</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">106</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened file&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After opening the proper video file, the video is processed frame by frame. The frame is sent to the lane detection algorithm, the traffic light recognition algorithm, the object recognition algorithm, and the dashboard visualization algorithm. Finally, the frame is visualized and saved.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">109</span>            <span class="c1"># Read frame</span>
<span class="linenos">110</span>            <span class="n">ret_vid</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">video_capture</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">111</span>
<span class="linenos">112</span>            <span class="k">if</span> <span class="n">ret_vid</span><span class="p">:</span>
<span class="linenos">113</span>
<span class="linenos">114</span>                <span class="n">frame</span> <span class="o">=</span> <span class="n">gammaCorrection</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mf">1.5</span><span class="p">)</span>
<span class="linenos">115</span>
<span class="linenos">116</span>                <span class="c1"># Detect lanes</span>
<span class="linenos">117</span>                <span class="n">lane_vid</span> <span class="o">=</span> <span class="n">lane_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">date_time_vid</span><span class="p">)</span>
<span class="linenos">118</span>
<span class="linenos">119</span>                <span class="c1"># Detect traffic lights</span>
<span class="linenos">120</span>                <span class="n">traffic_lights_boxes</span><span class="p">,</span> <span class="n">traffic_lights_labels</span> <span class="o">=</span> <span class="n">traffic_light_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">date_time_vid</span><span class="p">)</span>
<span class="linenos">121</span>                <span class="n">traffic_light_vid</span> <span class="o">=</span> <span class="n">traffic_light_detector</span><span class="o">.</span><span class="n">vis_result</span><span class="p">(</span><span class="n">lane_vid</span><span class="p">,</span> <span class="n">traffic_lights_boxes</span><span class="p">,</span> <span class="n">traffic_lights_labels</span><span class="p">)</span>
<span class="linenos">122</span>
<span class="linenos">123</span>                <span class="c1"># Detect objects</span>
<span class="linenos">124</span>                <span class="n">objects_dataFrame</span> <span class="o">=</span> <span class="n">object_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">date_time_vid</span><span class="p">)</span>
<span class="linenos">125</span>                <span class="n">objects_vid</span> <span class="o">=</span> <span class="n">object_detector</span><span class="o">.</span><span class="n">vis_result</span><span class="p">(</span><span class="n">traffic_light_vid</span><span class="p">,</span> <span class="n">objects_dataFrame</span><span class="p">)</span>
<span class="linenos">126</span>
<span class="linenos">127</span>                <span class="c1"># Visualize dashboard data</span>
<span class="linenos">128</span>                <span class="n">dashboard_vid</span> <span class="o">=</span> <span class="n">dashboard_vis</span><span class="o">.</span><span class="n">vis_data</span><span class="p">(</span><span class="n">objects_vid</span><span class="p">,</span> <span class="n">date_time_vid</span><span class="p">)</span>
<span class="linenos">129</span>
<span class="linenos">130</span>                <span class="c1"># Visualize the results</span>
<span class="linenos">131</span>                <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dashboard_vid</span><span class="p">)</span>
<span class="linenos">132</span>                <span class="n">frame_saved</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">dashboard_vid</span><span class="p">,</span> <span class="p">(</span><span class="mi">853</span><span class="p">,</span> <span class="mi">480</span><span class="p">))</span>
<span class="linenos">133</span>                <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">frame_saved</span><span class="p">)</span>
<span class="linenos">134</span>                <span class="n">keypressed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">135</span>                <span class="k">if</span> <span class="n">keypressed</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">):</span>
<span class="linenos">136</span>                    <span class="k">break</span>
<span class="linenos">137</span>
</pre></div>
</div>
</section>
<section id="parameters-to-change">
<h2>Parameters to change<a class="headerlink" href="#parameters-to-change" title="Permalink to this heading"></a></h2>
<p>The parameters that can be changed to change the behavior of the algorithms for the vehicle (public highway) are:</p>
<ol class="arabic simple">
<li><p>Lane Detection</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><strong>Detection threshold of lane Detection</strong> : The detection threshold dictates with what confidence will be detected the lane lines. The higher the value, the more confident the algorithm will be to detect the lane lines, but with higher value more lanes will be dismissed. The value is between 0 and 1. The default value is 0.3.</p></li>
<li><p><strong>Distance threshold</strong> : The distance threshold is the distance that will be needed to detect a lane change, i.e., if the distance of the lane detected is lower than this value the algorithm will <strong>NOT</strong> detect a lane change. The values is given in pixels. The default value is 100.</p></li>
<li><p><strong>Distance from center of image</strong>: The distance from the center of the image is the maximum distance to consider a lane line as a lane line to detect a lane change. The value is given in pixels. The default value is 100.</p></li>
<li><p><strong>Number of frames to maintain detected lane</strong> : The number of frames to maintain detected lane is the number of frames that the algorithm will maintain the detected lane, even if the lane is not detected. This is done to avoid the detection of a lane change when the lane is not detected. The value is given in frames. The default value is 5.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Traffic Light Recognition</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><strong>Detection threshold of traffic lights detection</strong> : The detection threshold dictates with what confidence will be detected the traffic lights. The higher the value, the more confident the algorithm will be to detect the traffic lights, but with higher value more traffic lights will be dismissed. The value is between 0 and 1. The default value is 0.3.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Object Recognition</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p><strong>Detection threshold of object detection</strong> : The detection threshold dictates with what confidence will be detected the objects. The higher the value, the more confident the algorithm will be to detect the objects, but with higher value more objects will be dismissed. The value is between 0 and 1. The default value is 0.6.</p></li>
</ul>
</div></blockquote>
</section>
<section id="algorithms-used">
<h2>Algorithms used<a class="headerlink" href="#algorithms-used" title="Permalink to this heading"></a></h2>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lanes.html">Lane Detection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="lanes.html#output-format">Output format</a></li>
<li class="toctree-l2"><a class="reference internal" href="lanes.html#class-docs">Class docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="traffic_lights.html">Traffic Lights Recognition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="traffic_lights.html#output-format">Output format</a></li>
<li class="toctree-l2"><a class="reference internal" href="traffic_lights.html#class-docs">Class docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="objects.html">Object Recognition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="objects.html#output-format">Output format</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html#class-docs">Class docs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard GUI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboard.html#class-docs">Class docs</a></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lanes.html" class="btn btn-neutral float-right" title="Lane Detection" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, UNAL.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>